$.fn.datepicker.defaults.format = "yyyy-mm-dd";

var lastPickedEventDate;

function getParameterByName(name, url) {
  if (!url) url = window.location.href;
  name = name.replace(/[\[\]]/g, "\\$&");
  var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
      results = regex.exec(url);
  if (!results) return null;
  if (!results[2]) return '';
  return decodeURIComponent(results[2].replace(/\+/g, " "));
}

$(function() {

  $(document).on('click', '.event_modal_link', function () {
    lastPickedEventDate = $(this).closest('td').attr('id');
  });

  $(document).on('hide.bs.modal', '#myModal', function() {
    $('.modal-note').hide();
    lastPickedEventDate = undefined;
  });

  $(document).on('change','#event_repeat_type',function() {
    $('.event_option').hide();
    switch (this.value) {
      case 'daily':
            $('#repeats_daily_options').show();
            break;
      case 'weekly':
            $('#repeats_weekly_options').show();
            break;
      case 'monthly':
            $('#repeats_monthly_options').show();
            break;
      case 'yearly':
            $('#repeats_yearly_options').show();
            break;
    }
  });

  $(document).on('shown.bs.modal', '#myModal', function() {
    $("#current_page_date").val(getParameterByName('start_date'));
    if (typeof lastPickedEventDate != 'undefined')
      $('.modal-note').fadeIn('slow').children('p').html('Selected day: ' + lastPickedEventDate);
  });
});

